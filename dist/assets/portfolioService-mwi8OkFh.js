import{c as l}from"./index-kwQw-hfp.js";class a{async getAuthedClient(t){const n=await t();if(!n)throw new Error("Failed to get valid authentication token");return console.log("Using token for Supabase client"),l(n)}async fetchHoldings(t,n){console.log("Fetching holdings for user:",t);const r=await this.getAuthedClient(n),{data:e,error:s}=await r.from("portfolio_holdings").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(s)throw console.error("Error fetching holdings:",s),s;return console.log("Fetched holdings:",e),(e||[]).map(o=>({id:o.id,symbol:o.symbol,name:o.name,amount:o.amount,avgPrice:o.avg_price,currentPrice:o.avg_price,purchaseDate:o.purchase_date,coinId:o.coin_id,notes:o.notes}))}async createHolding(t,n,r){console.log("Creating holding for user:",t,"holding:",r);const e=await this.getAuthedClient(n),{data:s,error:o}=await e.from("portfolio_holdings").insert({user_id:t,symbol:r.symbol,name:r.name,amount:r.amount,avg_price:r.avgPrice,coin_id:r.coinId,purchase_date:r.purchaseDate,notes:r.notes||null}).select().single();if(o)throw console.error("Database error details:",o),o;return console.log("Successfully created holding:",s),s}async updateHolding(t,n,r,e){console.log("Updating holding:",r,"with data:",e);const s=await this.getAuthedClient(n),o={};e.symbol&&(o.symbol=e.symbol),e.name&&(o.name=e.name),e.amount!==void 0&&(o.amount=e.amount),e.avgPrice!==void 0&&(o.avg_price=e.avgPrice),e.coinId&&(o.coin_id=e.coinId),e.purchaseDate&&(o.purchase_date=e.purchaseDate),e.notes!==void 0&&(o.notes=e.notes);const{data:c,error:i}=await s.from("portfolio_holdings").update(o).eq("id",r).eq("user_id",t).select().single();if(i)throw console.error("Update error:",i),i;return console.log("Successfully updated holding:",c),c}async deleteHolding(t,n,r){console.log("Deleting holding:",r);const e=await this.getAuthedClient(n),{error:s}=await e.from("portfolio_holdings").delete().eq("id",r).eq("user_id",t);if(s)throw console.error("Delete error:",s),s;console.log("Successfully deleted holding")}}const g=new a;export{a as PortfolioService,g as portfolioService};
